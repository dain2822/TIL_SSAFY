## 250925

### [Objectives_ 학습 목표]

- View 함수에서 QuerySet API를 활용하여 데이터를 조회(Read), 생성(Create), 수정(Update), 삭제(Delete)하는 전 과정을 구현할 수 있음
- HTTP request methods(GET, POST) 개념과 각각의 특징 및 적절한 사용법을 설명할 수 있음
- 클라이언트 요청에 대한 서버의 처리 결과를 나타내는 HTTP request status code 의미를 이해함
- CSRF(Cross-Site Request Forgery) 공격의 개념을 이해하고, Django에서 CSRF 토큰을 적용하는 방법을 학습함
- POST 요청 처리 후 중복 데이터 생성과 같은 문제점을 인지하고, redirect() 함수를 활용한 적절한 응답 처리 방식을 구현할 수 있음
- 캐시(Cache)의 개념과 장점을 이해하고, GET과 POST 메서드의 차이점을 명확히 비교할 수 있음

---

### [Build_ 이론]

### Read

**2가지 Read(조회) 진행**

1. 전체 게시글 조회
2. 단일 게시글 조회✅
    - 단일 게시글 조회
        - 최종 결과화면 미리보기
            
            ![image.png](attachment:0ba618ae-1d4d-46b5-9d1e-9e757586a81c:image.png)
            
        - 단일 게시글 조회 구현
            
            ![image.png](attachment:c19a6e0f-c3c6-46ad-b0ca-2ddb869e2b40:image.png)
            
    - 단일 게시글 이동 페이지 링크 작성
        - 최종 결과 화면 미리보기
            
            ![image.png](attachment:ce89879c-e5c2-4d3e-b76e-40b47482c502:image.png)
            
        - 단일 게시글 이동 페이지 링크 구현
            
            ![image.png](attachment:d235e97c-8a73-42a8-b60b-ed0c15373ab6:image.png)
            

### Create

- Create 로직을 구현하기 위해 필요한 view 함수의 개수는?
    
    ![image.png](attachment:cb2834cf-ce9d-4943-8bac-3fbb04cd451c:image.png)
    
    → Create 로직 구현에는 두 개의 view 함수가 필요함
    
- new _ 페이지 렌더링 기능 구현
    - 최종 결과 화면 미리보기
        
        ![image.png](attachment:2666d77e-77ae-4683-b2a9-0f314b5d14f3:image.png)
        
    - 게시글 생성 페이지 구현
        
        ![image.png](attachment:4ce1a4a7-3621-474a-b3a9-2bed4683e003:image.png)
        
    - Index 페이지에 new 페이지로 이동할 수 있는 하이퍼링크 작성
        
        ![image.png](attachment:d22d8250-7a5f-4ba8-b488-bcce075f3085:image.png)
        

- create _ 데이터 저장 기능 구현
    - 최종 결과 화면 미리보기
        
        ![image.png](attachment:28a2bcba-404b-4220-bbc5-123fc5dbd1c5:image.png)
        
    - 데이터 저장 기능 구현
        
        ![image.png](attachment:75b23428-bb14-4964-a992-dde9edb280ee:image.png)
        

---

### HTTP request methods

**HTTP**

: 네트워크 상에서 데이터(리소스)를 주고 받기 위한 약속

**HTTP request methods란?**

: 데이터에 대해 수행을 원하는 작업(행동)을 나타내는 것

→ 서버에게 원하는 작업의 종류를 알려주는 역할

- 대표적인 메서드
    - GET
        
        : 리소스 조회
        
        - URL에 데이터가 노출됨
        - 캐싱 가능
    - POST
        
        : 데이터 생성 / 전송
        
        - 요청 본문에 데이터
        - 데이터 노출 없음

**GET 메서드**

: 서버로부터 데이터를 요청하고 받아오는 데(조회) 사용

→ 주로 검색 쿼리 전송, 웹 페이지 요청, API에서 데이터를 조회하는 것과 같이 서버로부터 데이터를 요청하고 받아오는데 사용됨

- ‘GET’ Method 특징
    1. 데이터 전송
        
        : URL의 쿼리 문자열(Query String)을 통해 데이터를 전송
        
        : http://127.0.0.1:8000/articles/create/?title=제목&content=내용
        
    2. 데이터 제한
        
        : URL 길이에 제한이 있어 대량의 데이터 전송에는 적합하지 않음
        
    3. 브라우저 히스토리
        
        : 요청 URL이 브라우저 히스토리에 남음
        
    4. 캐싱
        
        : 브라우저는 GET 요청의 응답을 로컬에 저장할 수 있음
        
        : 동일한 URL로 다시 요청할 때, 서버에 접속하지 않고 저장된 결과를 사용
        
        : 페이지 로딩 시간을 크게 단축
        

**POST 메서드**

: 서버에 데이터를 제출하여 리소스를 변경(생성, 수정, 삭제)하는 데 사용

→ 주로 로그인 정보 제출, 파일 업로드, 새 데이터 생성(ex: 새 게시글 작성), API에서 데이터 변경을 요청하는 것과 같이 클라이언트가 서버로 데이터를 전송하여 서버의 상태를 변경할 때 사용됨

- ‘POST’ Method 특징
    1. 데이터 전송
        
        : HTTP Body를 통해 데이터를 전송
        
    2. 데이터 제한
        
        : GET에 비해 더 많은 양의 데이터를 전송할 수 있음
        
    3. 브라우저 히스토리
        
        : POST 요청은 브라우저 히스토리에 남지 않음
        
    4. 캐싱
        
        : POST 요청은 기본적으로 캐시할 수 없음
        
        : POST 요청이 일반적으로 서버의 상태를 변경하는 작업을 수행하기 때문
        

**’GET’ & ‘POST’ Method 정리**

: GET과 POST는 각각의 특성에 맞게 적절히 사용해야 함

- GET : 데이터 조회
- POST : 데이터 생성이나 수정에 주로 사용

**POST method 변경**

- Create 로직 수정_ http method POST로 변경
    
    : new.html의 form 요청은 새로운 article(새로운 데이터)을 생성하는 요청
    
    → POST method로 서버에 전달되는 것이 적절함
    
    ![image.png](attachment:b26537f5-4711-4f69-96e1-0e14e3516057:image.png)
    
- Create 로직 수정_ http method 변경 후 게시글 생성 테스트
    
    : 게시글 작성 후 403 응답 확인
    
    ![image.png](attachment:b5ab7ca7-7ee6-4b39-8686-7fe6bc5e25f8:image.png)
    

### HTTP response status code

: 서버가 클라이언트의 요청에 대한 처리 결과를 나타내는 3자리 숫자

→ 클라이언트는 이 코드를 통해 요청이 성공했는지, 실패했는지, 혹은 추가적인 조치가 필요한지 즉시 파악할 수 있음

→ 웹 브라우저는 적절한 메시지를 사용자에게 표시하거나, 개발자는 문제 해결을 위한 단서를 얻게 됨

**403 Forbidden 응답의 의미**

: 서버에 요청이 전달되었지만, 권한 때문에 거절되었음을 의미

→ CSRF token이 누락되었다는 응답

![image.png](attachment:3558526a-63df-4990-9924-a65017ca81c4:image.png)

**CSRF_ Cross-Site Request Forgery**

: 사이트 간 요청 위조

: 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행동(글쓰기, 정보 수정, 송금 등)을 특정 웹사이트에 요청하게 만드는 해킹 방식

- CSRF(위조된 인감도장)
    - 신뢰할 수 있는 관계(로그인)
        
        : 사용자는 은행(ex: bank.com)에 정상적으로 로그인하여, 은행은 사용자를 신뢰하고 있다는 증표(세션 쿠키)를 브라우저에 발급 → 이 쿠키가 ‘인감도장’
        
    - 악성 위임장(악성 링크)
        
        : 사기꾼(해커)은 ‘무료 경품 이벤트!’와 같은 미끼 링크를 사용자에게 보냄
        
        : 링크의 실제 내용은 “내 돈 100만원을 해커에게 송금하라”는 내용이 담긴, 인감도장만 찍으면 되는 ‘위조된 위임장’
        
    - 나도 모르는 날인(요청 전송)
        
        : 사용자가 미끼 링크를 클릭하는 순간, 브라우저는 자기도 모르게 bank.com에 위조된 위임장(송금 요청)을 보냄
        
        → 브라우저는 bank.com에 보낼 때마다 인감도장(세션 쿠키)을 자동으로 찍어서 보냄
        
    - 은행의 착각(공격 성공)
        
        : 은행 입장에서는 정상적인 인감도장이 찍힌 위임장이 도착했으므로, 요청이 진자 의사라고 믿고 송금 실행
        
    
- CSRF 공격의 방어
    - Django는 이런 공격을 막기 위해 CSRF 토큰이라는 안전장치를 사용
    - 위임장에 진자 서명이 있는지 확인하는 것처럼, 모든 중요한 요청에 “내가 직접 보낸 요청이 맞다”는 일회용 비밀 코드를 함께 보내도록 하여 위조된 요청을 막아줌

- CSRF Token 적용
    - DTL의 csrf_token 태그를 사용해 손쉽게 사용자에게 토큰 값을 부여
    - 요청 시 토큰 값도 함께 서버로 전송될 수 있도록 하는 것
        
        ![image.png](attachment:118881dc-324a-4ba4-8e0f-00a1f0f49eef:image.png)
        

- 요청 시 CSRF Token을 함께 보내야 하는 이유
    - Django 서버는 해당 요청이 DB에 데이터를 하나 생성하는(DB에 영향을 주는) 요청에 대해 “Django가 직접 제공한 페이지에서 데이터를 작성하고 있는 것인지”에 대한 확인 수단이 필요한 것
    - 겉모습이 똑같은 위조 사이트나 정상적이지 않은 요청에 대한 방어 수단
    - 기존 요청 형태
        
        : 요청 데이터 → 게시글 작성
        
    - 변경 요청 형태
        
        : 요청 데이터 + 인증 토큰 → 게시글 작성
        
- POST일 때만 Token을 확인하는 이유
    
    : POST는 단순 조회(GET)와 달리 리소스의 변경(생성, 수정, 삭제)을 요청하는 의미와 기술적 특성을 지님
    
    : DB에 조작을 가하는 요청은 반드시 인증 수단이 필요함
    
    → 데이터베이스에 대한 변경 사항을 만드는 요청이기 때문에 토큰을 사용해 최소한의 신원 확인을 하는 것
    

### Redirect

- 현재 문제 상황 : 게시글 작성 후 응답 방식
    - 현재 서비스는 게시글 작성(POST 요청) 이후, “게시글이 성공적으로 작성되었습니다”와 같은 완료 메시지 페이지를 직접 반환함
        
        → 게시글 저장 후 페이지를 응답하는 것은 POST 요청에 대한 적절한 응답이 아님
        
    - 후속 행동(ex : 새로고침, 뒤로 가기)에서 예기치 않은 동작을 유발할 수 있음
    
- 게시글 작성 성공 페이지 응답의 문제점
    - HTTP 표준 관점
        - POST 요청은 데이터 생성/변경에 사용되며, 동일 요청이 반복되면 안됨
        - 현재 방식에서 사용자가 완료 페이지에서 새로고침 시 중복 게시물 작성의 위험이 있음
        
        ![image.png](attachment:662dc6c0-851b-48c9-936f-a286a3f87d76:image.png)
        
    - 사용자 경험(UX) 관점
        - 작성 완료 후 완료 페이지를 직접 응답하는 방식은 직관적이지 않고, 사용자가 예상하는 흐름과 다름
        - 브라우저의 페이지 기록 관리와 상태 관리에 혼란을 줄 수 있음
        
        ![image.png](attachment:43423cc7-88b1-4371-a8e1-03e0f167f260:image.png)
        
- 게시글 작성 성공 후 적절한 응답 방법
    
    ⇒ 서버는 데이터 저장 후 페이지를 응답하는 것이 아닌 사용자를 적절한 기존 페이지로 보내야 함
    
    - 사용자를 보낸다 → 사용자가 GET 요청을 한 번 더 보내도록 해야 함
    - 실제로 서버가 클라이언트를 직접 다른 페이지로 보내는 것이 아닌 클라이언트가 GET 요청을 한 번 더 보내도록 응답하는 것
    

**redirect()**

: 클라이언트가 인자에 작성된 주소로 다시 요청을 보내도록 하는 함수

- redirect() 함수 적용
    - create view 함수 변경
        
        ![image.png](attachment:992cc405-865e-465e-bb52-cb5c363dfcdb:image.png)
        
- redirect 동작 원리
    1. redirect 응답을 받은 클라이언트는 detail url로 다시 요청을 보내게 됨
    2. 결과적으로 detail view 함수가 호출되어 detail view 함수의 반환 결과인 detail 페이지를 응답 받게 되는 것
    
    ⇒ 결국 사용자는 게시글 작성 후 작성된 게시글의 detail 페이지로 이동하는 것으로 느끼게 됨
    
    ![image.png](attachment:aeff2a99-55a2-4bbf-a006-740b5972cdc8:image.png)
    

![image.png](attachment:34e98fac-7d89-44cc-aaa4-962990a2699b:image.png)

- 게시글 작성 결과
    
    : 게시글 작성 후 생성 된 게시글의 detail 페이지로 redirect 되었는지 확인
    
    : create 요청 이후에 detail로 다시 요청을 보냈다는 것을 알 수 있음
    
    ![image.png](attachment:75056c55-8b20-4000-acae-8d7bd1e713c8:image.png)
    

---

### Delete

- delete_ 기능 구현
    - 최종 결과 화면 미리보기
        
        ![image.png](attachment:4edf1772-a768-4f8f-8e3e-a653bd362b4e:image.png)
        
    
    ![image.png](attachment:35580045-3405-4aaa-ba8e-b143e1a4198a:image.png)
    

### Update

- Update 로직을 구현하기 위해 필요한 view 함수의 개수는?

![image.png](attachment:a885b553-9a3a-454a-b01c-e2c68dcc2670:image.png)

⇒ Update 로직 구현에는 두 개의 view 함수가 필요함

- edit_ 페이지 렌더링 기능 구현
    - 최종 결과 화면 미리보기
    
    ![image.png](attachment:5e0bef97-64ec-49f4-8e73-7532d23e647f:image.png)
    
    - 기능 구현
    
    ![image.png](attachment:74e93b36-e9bc-47ca-8588-730d3720aede:image.png)
    
    - 수정 시 이전 데이터가 출력될 수 있도록 작성하기
        
        ![image.png](attachment:b0bff8ba-9475-4019-8ad9-ca0eed3931da:image.png)
        
        - input 요소
            
            : 한 줄 텍스트(ex : 제목) value 속성으로 기존 데이터 입력
            
            ![image.png](attachment:ea814019-58d4-4acb-bf41-a43bbe856e1d:image.png)
            
        - textarea 요소
            
            : 여러 줄 텍스트(ex : 본문) value 속성이 없고 태그 여닫는 사이에 값을 넣음
            
            ![image.png](attachment:f66402ac-985c-4f5a-8c1f-5d06fb2eaaee:image.png)
            
    
    - edit 페이지로 이동하기 위한 하이퍼링크 작성
    
    ![image.png](attachment:565b17b4-2e41-4f38-bf2d-853dca3c35aa:image.png)
    

- update_ 기능 구현
    
    ![image.png](attachment:95dfa0b3-db13-4bf6-a9ff-2b8b36d0a70f:image.png)
    
    - 작성 후 게시글 수정 테스트
    
    ![image.png](attachment:118c3394-5942-42f0-9e47-1a6b19458835:image.png)
    

---
